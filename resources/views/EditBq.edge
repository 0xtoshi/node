@include('BqLayout/head')
    <body>
	
		<!-- Main Wrapper -->
        <div class="main-wrapper">
		
			<!-- Header -->
            @include('BqLayout/navbar')
			<!-- /Sidebar -->
			
			<!-- Page Wrapper -->
            <div class="page-wrapper">
                <div class="content container-fluid">
				
					<!-- Page Header -->
					<div class="page-header">
						<div class="row">
							<div class="col-sm-12">

								<ul class="breadcrumb">
									<li class="breadcrumb-item"><a href="/bq">Tambah BQ Tender</a></li>
									
								</ul>
							</div>
						</div>
					</div>
					<!-- /Page Header -->
					
					<div class="row">
						<div class="col-sm-12">
							<div class="card">
                                <div class="card-header">
									<h4 class="card-title text-center"> <i class="fa fa-plus"></i> FORM TAMBAH BQ</h4>
									<br/>
									<a href="/bq" class="btn btn-primary"><i class="fa fa-arrow-left"></i> Kembali </a>
									
                                </div>
                                <div class="card-body">
                                    <div id="notice"></div>
                                    <form id="tambah_bq">
                                    <input type="hidden" name="id" value="{{ BQS.id }}">
                                       <div class="FORM-TENDER">
                                        <div class="form-group row">
                                           <label class="control-label col-sm-2 align-self-center mb-0" for="nama_tender">Nama Tender:</label>
                                           <div class="col-sm-8">
                                           <input type="text" class="form-control" name="nama_tender" value="{{ BQS.nama }}" id="nama_tender"  placeholder="Nama Tender" required>
                                           </div>
                                        </div>
                                        <div class="form-group row">
                                           <label class="control-label col-sm-2 align-self-center mb-0" for="nama_tender">Nilai Tender:</label>
                                           <div class="col-sm-8">
                                              <input type="number" class="form-control" value="{{ BQS.nilai }}" name="nilai_tender" id="nilai_tender"  placeholder="Nilai Tender" required>
                                           </div>
                                        </div>
                                        <div class="form-group row">
                                           <label class="control-label col-sm-2 align-self-center mb-0" for="nama_tender">Nama Instansi:</label>
                                           <div class="col-sm-8">
                                              <input type="text" class="form-control" value="{{ BQS.instansi }}" name="instansi_tender" id="instansi_tender"  placeholder="Nama Instansi" required>
                                           </div>
                                        </div>
          
                                        <div class="form-group row">
                                           <label class="control-label col-sm-2 align-self-center mb-0" for="nama_tender">Lama Tender:</label>
                                           <div class="col-sm-1">
                                              <input type="number" class="form-control" value="{{ BQS.lama_tender }}" name="lama_tender" id="lama_tender" placeholder="Bulan" required>
                                           </div>
                                        </div>
                                       </div>
          
                                        <!-- 
                                            'jabatan' => $request->input('jabatan'),
                                              'gaji' => $request->input('gaji'),
                                              'jumlah' => $request->input('jumlah'),
                                              'id_bq' => $ID_BQ->id
                                        -->
                                        @each(data in Personils)
                                        <div id="personil_form" class="row">
                                          @if( $loop.index == 0 ) 
                                          <div class="col-sm-2">
                                               <label class="text-black"> Personil </label>
                                           </div>
                                           @else
                                           <div class="col-sm-2"></div>
                                           @endif
                                           <input type="hidden" name="id_personil[]" value="{{ data.id }}">
                                           <div class="col-sm-3">
                                               <label> Jabatan </label>
                                           
                                           <input type="text" class="form-control" name="personil_jabatan[]" value="{{ data.jabatan }}" id="personil_jabatan" placeholder="Jabatan" required>
                                           </div>
                                           <div class="col-sm-3">
                                              <label> Gaji (RP) </label>
                                              <input type="number" class="form-control" name="personil_gaji[]" value="{{ data.gaji }}" id="personil_gaji" placeholder="Gaji" required>
                                           </div>
                                           <div class="col-sm-2">
                                              <label> Jumlah </label>
                                              <input type="number" class="form-control" name="personil_jumlah[]" value="{{ data.jumlah }}" id="personil_jumlah" placeholder="Jumlah" required>
                                           </div> 

                                        </div>
                                        @endeach
                                        
                                        <div id="personil_row"></div>
                                        <br/>
                                        <div class="row">
                                        <div class="col-md-2"></div>
                                        <div class="col-sm-3">
                                             <button id="personil-add" type="button" class="btn btn-success btn-sm"><i class="fa fa-plus"></i> Tambah Row</button>
                                        </div>
                                        </div>
                                        <br/>
                                        <!-- 
                                            'nama' => $request->input('nama'),
                                              'nominal' => $request->input('nominal'),
                                              'jumlah' => $request->input('jumlah'),
                                              'id_bq' => $ID_BQ->id
                                         -->
                                        @each(data in Perlengkapans)
                                        <div id="perlengkapan_form" class="row">
                                          @if( $loop.index == 0 ) 
                                          <div class="col-sm-2">
                                               <label class="text-black"> Perlengkapan </label>
                                           </div>
                                           @else
                                           <div class="col-sm-2"></div>
                                           @endif
                                           <input type="hidden" name="id_perlengkapan[]" value="{{ data.id }}">
                                           <div class="col-sm-3">
                                               <label> Nama Barang </label>
                                           <input type="text" class="form-control" name="nama_perlengkapan[]" value="{{ data.nama }}" id="nama_perlengkapan" placeholder="Nama Barang" required>
                                           </div>
                                           <div class="col-sm-3">
                                              <label> Nominal (RP) </label>
                                              <input type="number" class="form-control" name="nominal_perlengkapan[]" value="{{ data.nominal }}" id="nominal_perlengkapan" placeholder="Nominal" required>
                                           </div>
                                           <div class="col-sm-2">
                                              <label> Jumlah </label>
                                              <input type="number" class="form-control" name="jumlah_perlengkapan[]" value="{{ data.jumlah }}" id="jumlah_perlengkapan" placeholder="Jumlah" required>
                                           </div>
                                        </div>
                                        @endeach
          
                                        <div id="perlengkapan_row"></div>
                                        <br/>
                                        <div class="row">
                                        <div class="col-md-2"></div>
                                        <div class="col-sm-3">
                                             <button id="perlengkapan-add" type="button" class="btn btn-success btn-sm"><i class="fa fa-plus"></i> Tambah Row</button>
                                        </div>
                                        </div>
                                        <br/>
          
                                        <!--
                                             'nama' => $request->input('nama'),
                                              'nominal' => $request->input('nominal'),
                                              'jumlah' => $request->input('jumlah'),
                                              'id_bq' => $ID_BQ->id
                                         -->
                                        @each(data in Lain2s)
                                        <div id="lain2_form" class="row">
                                          @if( $loop.index == 0 ) 
                                          <div class="col-sm-2">
                                               <label class="text-black"> Lain-Lain </label>
                                           </div>
                                           @else
                                           <div class="col-sm-2"></div>
                                           @endif
                                           <input type="hidden" name="id_lain2[]" value="{{ data.id }}">
                                           <div class="col-sm-3">
                                               <label> Nama Item </label>
                                           <input type="text" id="nama_lain2" name="nama_lain2[]" value="{{ data.nama }}" class="form-control" placeholder="Nama Item " required>
                                           </div>
                                           <div class="col-sm-3">
                                              <label> Nominal (RP) </label>
                                              <input type="number" id="nominal_lain2" name="nominal_lain2[]" value="{{ data.nominal }}" class="form-control" placeholder="Nominal" required>
                                           </div>
                                           <div class="col-sm-2">
                                              <label> Jumlah </label>
                                              <input type="number" id="jumlah_lain2" name="jumlah_lain2[]" value="{{ data.jumlah }}" class="form-control" placeholder="Jumlah" required>
                                           </div>
                                        </div>
                                        @endeach
                                        
                                        <div id="lain2_row"></div>
                                        <br/>
                                        <div class="row">
                                        <div class="col-md-2"></div>
                                        <div class="col-sm-3">
                                             <button id="lain2-add" type="button" class="btn btn-success btn-sm"><i class="fa fa-plus"></i> Tambah Row</button>
                                        </div>
                                        </div>
                                        <br/>
                                        
                                        <div class="form-group">
                                           <button id="Tambah" type="submit" class="btn btn-primary">Submit</button>
                                          
                                        </div>
          
                                        </form>
          
                                    
                                </div>
                            </div>
						</div>			
					</div>
					
				</div>			
			</div>
			<!-- /Page Wrapper -->
		
        </div>
		<!-- /Main Wrapper -->
		
@include('BqLayout/footer')

<script>

(function ($) {
				$.fn.serializeFormJSON = function () {

					var o = {};
					var a = this.serializeArray();
					$.each(a, function () {
						if (o[this.name]) {
							if (!o[this.name].push) {
								o[this.name] = [o[this.name]];
							}
							o[this.name].push(this.value || '');
						} else {
							o[this.name] = this.value || '';
						}
					});
					return o;
				};
			})(jQuery);

   $('document').ready(()=> {

      console.log('Document Ready!')

      var i=1;
      $('#personil-add').click(function(){
         i++;
         console.log('CLICKED' + i )
         $('#personil_row').append('<div id="personil_'+i+'" class="row"><div class="col-sm-2"></div><div class="col-sm-3"><input type="text" class="form-control" name="personil_jabatan[]" id="personil_jabatan" placeholder="Jabatan" required></div><div class="col-sm-3"><input type="number" class="form-control" name="personil_gaji[]" id="personil_gaji" placeholder="Gaji" required></div><div class="col-sm-2"><input type="number" class="form-control" name="personil_jumlah[]" id="personil_jumlah" placeholder="Jumlah" required></div> <button type="button" id="'+i+'" class="btn btn-danger"><i class="fa fa-trash"></i></button> </div> ');
      });
      
      $(document).on('click', '.btn-danger', function(){
         var button_id = $(this).attr("id"); 
         $('#personil_'+button_id+'').remove();
      });

      $('#perlengkapan-add').click(function(){
         i++;
         console.log('CLICKED' + i )
         $('#perlengkapan_row').append('<div id="perlengkapan_'+i+'" class="row"><div class="col-sm-2"></div><div class="col-sm-3"><input type="text" class="form-control" name="nama_perlengkapan" id="nama_perlengkapan" placeholder="Nama Barang" required></div><div class="col-sm-3"><input type="number" class="form-control" name="nominal_perlengkapan[]" id="nominal_perlengkapan" placeholder="Nominal" required></div><div class="col-sm-2"><input type="number" class="form-control" name="jumlah_perlengkapan[]" id="jumlah_perlengkapan" placeholder="Jumlah" required></div> <button type="button" id="'+i+'" class="btn btn-danger"><i class="fa fa-trash"></i></button> </div> ');
      });
      
      $(document).on('click', '.btn-danger', function(){
         var button_id = $(this).attr("id"); 
         $('#perlengkapan_'+button_id+'').remove();
      });

      $('#lain2-add').click(function(){
         i++;
         console.log('CLICKED' + i )
         $('#lain2_row').append('<div id="personil_'+i+'" class="row"><div class="col-sm-2"></div><div class="col-sm-3"><input type="text" class="form-control" name="nama_lain2" id="nama_lain2" placeholder="Nama Item" required></div><div class="col-sm-3"><input type="number" class="form-control" name="nominal_lain2[]" id="nominal_lain2" placeholder="Nominal" required></div><div class="col-sm-2"><input type="number" class="form-control" name="jumlah_lain2[]" id="jumlah_perlengkapan" placeholder="Jumlah" required></div> <button type="button" id="'+i+'" class="btn btn-danger"><i class="fa fa-trash"></i></button> </div> ');
      });
      
      $(document).on('click', '.btn-danger', function(){
         var button_id = $(this).attr("id"); 
         $('#lain2_'+button_id+'').remove();
      });


      $('#tambah_bq').submit((e) => {

         e.preventDefault()

         var tender_param = $('#tambah_bq').serializeFormJSON()
         console.log(tender_param)

         $.ajax({

            url : '/Api/UpdateMultiBQ',
            method : 'POST',
            data : tender_param,
            success : (data) => {
               $('#notice').html('<div class="alert alert-success">'+data.msg+'</div>')
               $('body').append('<meta http-equiv="refresh" content="2">');
            },
            error : (error) => {
               $('#notice').html('<div class="alert alert-danger">Gagal Menyimpan BQ Tender Pastikan Form sudah diisi dengan benar!</div>')
            }
         })

      })

   })
   

</script>